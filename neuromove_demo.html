<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NeuroMove EduFit+ — Demo Campus Mobile</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1a30;
      --muted:#9fb0d0;
      --text:#eef2ff;
      --accent:#2d6cdf;
      --accent2:#22c55e;
      --warning:#f59e0b;
      --danger:#ef4444;
      --border: rgba(255,255,255,.08);
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      background: radial-gradient(900px 450px at 20% 10%, rgba(45,108,223,.25), transparent 60%),
                  radial-gradient(900px 450px at 80% 0%, rgba(34,197,94,.18), transparent 60%),
                  linear-gradient(180deg, #070b14, #0b1220 40%, #070b14);
      color: var(--text);
      min-height:100vh;
    }
    .app{
      max-width: 1040px;
      margin: 0 auto;
      padding: 22px 16px 28px;
    }
    header{
      display:flex; align-items:center; justify-content:space-between;
      gap: 12px;
      margin-bottom: 14px;
    }
    .brand{
      display:flex; align-items:center; gap: 12px;
    }
    .logo{
      width:42px; height:42px; border-radius: 12px;
      background: linear-gradient(135deg, rgba(45,108,223,.95), rgba(34,197,94,.85));
      box-shadow: var(--shadow);
    }
    .brand h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
      line-height: 1.1;
    }
    .brand p{
      margin:2px 0 0;
      font-size: 12px;
      color: var(--muted);
    }
    .top-actions{
      display:flex; gap: 10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .btn{
      cursor:pointer;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      display:inline-flex;
      gap: 8px;
      align-items:center;
      transition: .15s ease;
      user-select:none;
      font-size: 13px;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }
    .btn.primary{ background: rgba(45,108,223,.18); border-color: rgba(45,108,223,.35); }
    .btn.success{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35); }
    .btn.danger{ background: rgba(239,68,68,.14); border-color: rgba(239,68,68,.25); }
    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 14px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
    }
    .card{
      background: rgba(255,255,255,.03);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .card .hd{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      display:flex; align-items:flex-start; justify-content:space-between;
      gap: 10px;
    }
    .card .hd h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.3px;
    }
    .card .hd span{
      color: var(--muted);
      font-size: 12px;
    }
    .card .bd{ padding: 14px; }
    .nav{
      display:flex; flex-direction:column; gap: 10px;
    }
    .nav-item{
      padding: 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      transition:.15s ease;
      display:flex; align-items:flex-start; justify-content:space-between;
      gap: 10px;
    }
    .nav-item:hover{ transform: translateY(-1px); background: rgba(255,255,255,.05); }
    .nav-item.active{
      border-color: rgba(45,108,223,.45);
      background: rgba(45,108,223,.14);
    }
    .nav-item h3{
      margin: 0 0 4px;
      font-size: 13px;
    }
    .nav-item p{
      margin:0;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
    .tag{
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      height: fit-content;
      margin-top: 2px;
      background: rgba(0,0,0,.12);
    }
    .form{
      display:grid; gap: 10px;
    }
    label{
      font-size: 12px;
      color: var(--muted);
      display:block;
      margin-bottom: 6px;
    }
    input, textarea, select{
      width:100%;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size: 13px;
    }
    textarea{ min-height: 100px; resize: vertical; }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
    }
    .notice{
      border-left: 4px solid rgba(245,158,11,.7);
      background: rgba(245,158,11,.10);
      padding: 10px 12px;
      border-radius: 14px;
      color: #ffe9bf;
      font-size: 12px;
      line-height: 1.4;
    }
    .muted{ color: var(--muted); font-size: 12px; }
    .plan{
      white-space: pre-wrap;
      line-height: 1.4;
      font-size: 13px;
      border-radius: 16px;
      padding: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
    }
    .list{
      display:grid; gap: 10px;
    }
    .exercise{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 10px;
    }
    .exercise h4{ margin:0 0 4px; font-size: 13px; }
    .exercise p{ margin:0; color: var(--muted); font-size: 12px; line-height:1.35; }
    .exercise .meta{ display:flex; gap: 8px; flex-wrap:wrap; margin-top: 8px; }
    .pill{
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.12);
      color: var(--muted);
    }
    .check{
      display:flex; align-items:center; gap:8px; font-size:12px; color: var(--muted);
      user-select:none;
    }
    .check input{ width: 16px; height: 16px; }
    .hr{ height:1px; background: var(--border); margin: 12px 0; }
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      padding: 4px 7px;
      border-radius: 10px;
      color: var(--muted);
    }
    footer{
      margin-top: 12px;
      color: var(--muted);
      font-size: 11px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>NeuroMove EduFit+ — Demo</h1>
          <p>Protótipo para apresentação no Campus Mobile (offline, roda no navegador)</p>
        </div>
      </div>
      <div class="top-actions">
        <div class="btn primary" id="btnGoAI" title="Ir para Assistente IA">
          Assistente IA <span class="kbd">Alt</span> + <span class="kbd">I</span>
        </div>
        <div class="btn success" id="btnGenerate" title="Gerar plano do dia">
          Gerar Plano do Dia
        </div>
        <div class="btn danger" id="btnReset" title="Resetar dados">
          Resetar
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- NAV -->
      <section class="card">
        <div class="hd">
          <div>
            <h2>Navegação</h2>
            <span>Fluxo para demonstração</span>
          </div>
          <span class="tag" id="demoStatus">Pronto</span>
        </div>
        <div class="bd">
          <div class="nav" id="nav"></div>

          <div class="hr"></div>
          <div class="notice">
            Aviso: conteúdo educativo. Interrompa se houver dor forte, tontura, formigamento intenso ou piora súbita.
          </div>

          <footer>
            Dica para a apresentação: mostre <b>Perfil → Avaliação → IA → Plano → Exercícios</b>.
          </footer>
        </div>
      </section>

      <!-- MAIN -->
      <main class="card">
        <div class="hd">
          <div>
            <h2 id="viewTitle">Home</h2>
            <span id="viewSubtitle">Visão geral do protótipo</span>
          </div>
          <span class="tag" id="viewTag">Demo</span>
        </div>
        <div class="bd" id="view"></div>
      </main>
    </div>
  </div>

<script>
  // --------------------------- DADOS (MVP) ---------------------------
  const STATE_KEY = "NEUROMOVE_DEMO_STATE_v1";
  const DEFAULT_STATE = {
    name: "Usuário",
    goal: "reduzir dor e aumentar mobilidade",
    level: "Leve",
    notes: "Tensão cervical e dificuldade no polegar.",
    planText: "",
    done: {}
  };

  const EXERCISES = [
    {
      id:"hand_mobility",
      titlePt:"Mobilidade da Mão",
      titleEn:"Hand Mobility",
      category:"Mãos",
      level:"Leve",
      durationMin:5,
      objective:"Aumentar mobilidade e controle fino da mão com movimentos lentos e seguros.",
      steps:[
        "Sente-se com o antebraço apoiado e a mão relaxada.",
        "Abra a mão (espalhe os dedos) por 3 segundos.",
        "Feche a mão lentamente (sem forçar) por 3 segundos.",
        "Repita de forma controlada, sem dor."
      ],
      setsReps:"3 séries de 10 repetições • descanso 30–40s",
      frequency:"1 a 2 vezes ao dia",
      cautions:"Pare se houver dor forte, formigamento intenso ou perda súbita de força."
    },
    {
      id:"finger_extension",
      titlePt:"Extensão dos Dedos",
      titleEn:"Finger Extension",
      category:"Mãos",
      level:"Leve",
      durationMin:8,
      objective:"Estimular extensão e coordenação dos dedos, com foco em polegar e indicador.",
      steps:[
        "Apoie a mão numa mesa, palma para baixo.",
        "Levante um dedo por vez, mantendo os outros apoiados.",
        "Segure 2 segundos e volte devagar.",
        "Depois levante todos os dedos juntos e volte lentamente."
      ],
      setsReps:"2×8 (um dedo por vez) + 2×10 (todos juntos)",
      frequency:"1 vez ao dia (ou dias alternados se houver fadiga)",
      cautions:"Evite compensar com ombro/tronco. O movimento é só na mão/dedos."
    },
    {
      id:"cervical_stretching",
      titlePt:"Alongamento Cervical Leve",
      titleEn:"Cervical Stretching",
      category:"Cervical",
      level:"Leve",
      durationMin:6,
      objective:"Reduzir tensão cervical e melhorar amplitude com segurança.",
      steps:[
        "Sente-se com coluna ereta e ombros relaxados.",
        "Incline a cabeça lentamente para a direita (orelha em direção ao ombro).",
        "Segure 15–20 segundos sem dor.",
        "Volte ao centro e repita para o lado esquerdo.",
        "Faça “olhar para baixo” (queixo ao peito) por 15 segundos."
      ],
      setsReps:"2 séries por direção • 15–20s cada posição",
      frequency:"1 a 2 vezes ao dia",
      cautions:"Não puxe a cabeça com a mão. Se houver tontura/náusea/dor irradiando, interrompa."
    }
  ];

  let state = loadState();
  let currentView = "home";
  let selectedExerciseId = null;

  const NAV_ITEMS = [
    { id:"home", title:"Home", subtitle:"Visão geral do protótipo", tag:"Start" },
    { id:"profile", title:"Patient Profile", subtitle:"Dados do usuário (demo)", tag:"Perfil" },
    { id:"assessment", title:"Assessments", subtitle:"Avaliação rápida para personalização", tag:"Entrada" },
    { id:"ai", title:"Assistente IA", subtitle:"Gera o Plano do Dia (offline)", tag:"IA" },
    { id:"plan", title:"Plano do Dia", subtitle:"Resultado gerado pelo assistente", tag:"Plano" },
    { id:"exercises", title:"Exercises", subtitle:"Lista de exercícios com detalhes", tag:"Execução" }
  ];

  // --------------------------- ATALHOS ---------------------------
  window.addEventListener("keydown", (e) => {
    if (e.altKey && e.key.toLowerCase() === "i") { go("ai"); }
  });

  // --------------------------- UI ---------------------------
  const navEl = document.getElementById("nav");
  const viewEl = document.getElementById("view");
  const viewTitleEl = document.getElementById("viewTitle");
  const viewSubtitleEl = document.getElementById("viewSubtitle");
  const viewTagEl = document.getElementById("viewTag");
  const demoStatusEl = document.getElementById("demoStatus");

  document.getElementById("btnGenerate").onclick = () => {
    generatePlanOffline();
    go("plan");
  };
  document.getElementById("btnReset").onclick = () => {
    state = structuredClone(DEFAULT_STATE);
    saveState();
    selectedExerciseId = null;
    go("home");
    toast("Reset concluído.");
  };
  document.getElementById("btnGoAI").onclick = () => go("ai");

  function renderNav(){
    navEl.innerHTML = "";
    NAV_ITEMS.forEach(item => {
      const div = document.createElement("div");
      div.className = "nav-item" + (currentView === item.id ? " active" : "");
      div.onclick = () => go(item.id);
      div.innerHTML = `
        <div>
          <h3>${escapeHtml(item.title)}</h3>
          <p>${escapeHtml(item.subtitle)}</p>
        </div>
        <div class="tag">${escapeHtml(item.tag)}</div>
      `;
      navEl.appendChild(div);
    });
  }

  function setHeader(title, subtitle, tag){
    viewTitleEl.textContent = title;
    viewSubtitleEl.textContent = subtitle;
    viewTagEl.textContent = tag;
  }

  function go(viewId){
    currentView = viewId;
    renderNav();
    renderView();
  }

  function renderView(){
    if (currentView === "home") return renderHome();
    if (currentView === "profile") return renderProfile();
    if (currentView === "assessment") return renderAssessment();
    if (currentView === "ai") return renderAI();
    if (currentView === "plan") return renderPlan();
    if (currentView === "exercises") return renderExercises();
  }

  function renderHome(){
    setHeader("Home", "Visão geral do protótipo", "Demo");
    viewEl.innerHTML = `
      <div class="card" style="margin-bottom:12px">
        <div class="bd">
          <h3 style="margin:0 0 8px;font-size:16px">O que você vai mostrar na banca</h3>
          <div class="muted">Fluxo recomendado (90 segundos):</div>
          <div class="plan" style="margin-top:10px">
1) Patient Profile → nome
2) Assessments → objetivo, nível, observações
3) Assistente IA → gerar Plano do Dia
4) Plano do Dia → abrir exercícios e marcar concluído
          </div>
          <div class="hr"></div>
          <div class="muted">
            Atalho: <span class="kbd">Alt</span> + <span class="kbd">I</span> abre o Assistente IA.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="bd">
          <h3 style="margin:0 0 10px;font-size:16px">Status da demonstração</h3>
          <div class="list">
            <div class="exercise">
              <div>
                <h4>Perfil</h4>
                <p>Nome: <b>${escapeHtml(state.name)}</b></p>
              </div>
              <div class="pill">OK</div>
            </div>
            <div class="exercise">
              <div>
                <h4>Avaliação</h4>
                <p>Objetivo: ${escapeHtml(state.goal)} • Nível: ${escapeHtml(state.level)}</p>
              </div>
              <div class="pill">OK</div>
            </div>
            <div class="exercise">
              <div>
                <h4>Plano IA</h4>
                <p>${state.planText ? "Gerado e pronto para apresentar." : "Ainda não gerado (clique em “Gerar Plano do Dia”)."}</p>
              </div>
              <div class="pill" style="${state.planText ? "" : "border-color: rgba(245,158,11,.35); color:#ffe9bf; background: rgba(245,158,11,.10)"}">
                ${state.planText ? "OK" : "Pendente"}
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    refreshDemoStatus();
  }

  function renderProfile(){
    setHeader("Patient Profile", "Dados do usuário (demo)", "Perfil");
    viewEl.innerHTML = `
      <div class="form">
        <div>
          <label>Nome</label>
          <input id="name" value="${escapeAttr(state.name)}" placeholder="Ex.: Átila / Usuário"/>
        </div>

        <div class="notice">
          Dica: na apresentação, explique que o perfil permite personalizar planos e registrar evolução ao longo do tempo.
        </div>
      </div>
    `;
    document.getElementById("name").addEventListener("input", (e)=>{
      state.name = e.target.value.trim() || "Usuário";
      saveState();
      refreshDemoStatus();
    });
  }

  function renderAssessment(){
    setHeader("Assessments", "Avaliação rápida para personalização", "Entrada");
    viewEl.innerHTML = `
      <div class="form">
        <div>
          <label>Objetivo do dia</label>
          <input id="goal" value="${escapeAttr(state.goal)}" placeholder="Ex.: reduzir dor, melhorar mobilidade"/>
        </div>

        <div class="row">
          <div>
            <label>Nível</label>
            <select id="level">
              <option ${state.level==="Leve"?"selected":""}>Leve</option>
              <option ${state.level==="Moderado"?"selected":""}>Moderado</option>
            </select>
          </div>
          <div>
            <label>Tempo disponível</label>
            <select id="time">
              <option selected>15–25 min</option>
              <option>10–15 min</option>
              <option>25–35 min</option>
            </select>
          </div>
        </div>

        <div>
          <label>Observações</label>
          <textarea id="notes" placeholder="Ex.: tensão cervical, dificuldade no polegar">${escapeHtml(state.notes)}</textarea>
        </div>

        <div class="notice">
          Segurança: interrompa se houver dor forte, tontura, formigamento intenso ou piora súbita.
        </div>
      </div>
    `;
    document.getElementById("goal").addEventListener("input",(e)=>{
      state.goal = e.target.value.trim() || state.goal;
      saveState(); refreshDemoStatus();
    });
    document.getElementById("level").addEventListener("change",(e)=>{
      state.level = e.target.value;
      saveState(); refreshDemoStatus();
    });
    document.getElementById("notes").addEventListener("input",(e)=>{
      state.notes = e.target.value.trim() || state.notes;
      saveState(); refreshDemoStatus();
    });
  }

  function renderAI(){
    setHeader("Assistente IA", "Gera o Plano do Dia (offline)", "IA");
    viewEl.innerHTML = `
      <div class="card" style="margin-bottom:12px">
        <div class="bd">
          <h3 style="margin:0 0 8px;font-size:16px">Modo de demonstração</h3>
          <div class="muted">Este assistente funciona offline (sem internet) para garantir a apresentação.</div>
          <div class="hr"></div>
          <div class="muted">Paciente: <b>${escapeHtml(state.name)}</b></div>
          <div class="muted">Objetivo: ${escapeHtml(state.goal)}</div>
          <div class="muted">Nível: ${escapeHtml(state.level)}</div>
          <div class="muted">Observações: ${escapeHtml(state.notes)}</div>
        </div>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <div class="btn success" id="genNow">Gerar Plano do Dia com IA</div>
        <div class="btn primary" id="goPlan">Ver Plano</div>
        <div class="btn" id="goEx">Abrir Exercícios</div>
      </div>

      <div class="hr"></div>
      <div class="muted">
        Se você quiser “IA online” depois, dá para integrar com API. Para a banca, o offline já valida o conceito e a experiência.
      </div>
    `;

    document.getElementById("genNow").onclick = () => {
      generatePlanOffline();
      go("plan");
    };
    document.getElementById("goPlan").onclick = () => go("plan");
    document.getElementById("goEx").onclick = () => go("exercises");
  }

  function renderPlan(){
    setHeader("Plano do Dia", "Resultado gerado pelo assistente", "Plano");
    viewEl.innerHTML = `
      <div class="plan">${escapeHtml(state.planText || "Clique em “Gerar Plano do Dia” para criar um plano.")}</div>
      <div class="hr"></div>

      <div class="muted" style="margin-bottom:8px"><b>Exercícios sugeridos</b></div>
      <div class="list" id="planList"></div>

      <div class="hr"></div>
      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <div class="btn success" id="regen">Regenerar Plano</div>
        <div class="btn primary" id="openEx">Abrir Exercícios</div>
      </div>
    `;

    const planList = document.getElementById("planList");
    EXERCISES.forEach(ex => {
      const div = document.createElement("div");
      div.className = "exercise";
      div.innerHTML = `
        <div>
          <h4>${escapeHtml(ex.titlePt)}</h4>
          <p>${escapeHtml(ex.category)} • ${ex.durationMin} min • ${escapeHtml(ex.level)}</p>
          <div class="meta">
            <span class="pill">${escapeHtml(ex.setsReps)}</span>
            <span class="pill">${escapeHtml(ex.frequency)}</span>
          </div>
        </div>
        <div class="btn primary" style="height:fit-content" data-open="${ex.id}">Ver</div>
      `;
      planList.appendChild(div);
    });

    planList.querySelectorAll("[data-open]").forEach(btn=>{
      btn.onclick = () => {
        selectedExerciseId = btn.getAttribute("data-open");
        go("exercises");
      };
    });

    document.getElementById("regen").onclick = () => {
      generatePlanOffline();
      go("plan");
    };
    document.getElementById("openEx").onclick = () => go("exercises");
    refreshDemoStatus();
  }

  function renderExercises(){
    setHeader("Exercises", "Lista de exercícios com detalhes", "Execução");

    const selected = selectedExerciseId
      ? EXERCISES.find(e => e.id === selectedExerciseId)
      : null;

    if (!selected){
      viewEl.innerHTML = `
        <div class="muted" style="margin-bottom:10px">
          Clique em um exercício para ver detalhes e marcar como concluído.
        </div>
        <div class="list" id="exList"></div>
      `;
      const exList = document.getElementById("exList");
      EXERCISES.forEach(ex => {
        const div = document.createElement("div");
        div.className = "exercise";
        div.innerHTML = `
          <div>
            <h4>${escapeHtml(ex.titleEn)} • ${escapeHtml(ex.titlePt)}</h4>
            <p>${escapeHtml(ex.category)} • ${ex.durationMin} min</p>
            <div class="meta">
              <span class="pill">${escapeHtml(ex.level)}</span>
              <span class="pill">${escapeHtml(ex.setsReps)}</span>
            </div>
          </div>
          <div class="btn primary" style="height:fit-content" data-open="${ex.id}">Abrir</div>
        `;
        exList.appendChild(div);
      });
      exList.querySelectorAll("[data-open]").forEach(btn=>{
        btn.onclick = () => {
          selectedExerciseId = btn.getAttribute("data-open");
          go("exercises");
        };
      });
      return;
    }

    // Detalhe
    const done = !!state.done[selected.id];
    viewEl.innerHTML = `
      <div class="card" style="margin-bottom:12px">
        <div class="bd">
          <h3 style="margin:0 0 6px;font-size:16px">${escapeHtml(selected.titlePt)}</h3>
          <div class="muted">${escapeHtml(selected.category)} • ${selected.durationMin} min • ${escapeHtml(selected.level)}</div>
          <div class="hr"></div>
          <div class="muted"><b>Objetivo</b></div>
          <div style="margin-top:6px">${escapeHtml(selected.objective)}</div>
        </div>
      </div>

      <div class="card" style="margin-bottom:12px">
        <div class="bd">
          <div class="muted"><b>Como fazer</b></div>
          <div style="margin-top:8px">
            ${selected.steps.map(s=>`<div style="display:flex; gap:10px; margin:6px 0"><div>•</div><div>${escapeHtml(s)}</div></div>`).join("")}
          </div>
          <div class="hr"></div>
          <div class="muted"><b>Séries/Repetições</b> — ${escapeHtml(selected.setsReps)}</div>
          <div class="muted" style="margin-top:6px"><b>Frequência</b> — ${escapeHtml(selected.frequency)}</div>
        </div>
      </div>

      <div class="card" style="margin-bottom:12px">
        <div class="bd">
          <div class="muted"><b>Cuidados</b></div>
          <div style="margin-top:6px; color:#ffe9bf">${escapeHtml(selected.cautions)}</div>
        </div>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
        <label class="check">
          <input type="checkbox" id="done" ${done ? "checked":""}/>
          Marcar como concluído (demo)
        </label>
        <div class="btn" id="back">Voltar para lista</div>
      </div>
    `;

    document.getElementById("done").addEventListener("change",(e)=>{
      state.done[selected.id] = e.target.checked;
      saveState(); refreshDemoStatus();
      toast(e.target.checked ? "Concluído." : "Desmarcado.");
    });
    document.getElementById("back").onclick = () => {
      selectedExerciseId = null;
      go("exercises");
    };
  }

  // --------------------------- "IA" OFFLINE ---------------------------
  function generatePlanOffline(){
    const intensity = state.level === "Moderado"
      ? "Hoje vamos em intensidade moderada, respeitando limites e pausas."
      : "Hoje vamos em intensidade leve, com foco em controle e segurança.";

    const safety = "Se houver dor forte, tontura, formigamento intenso ou piora súbita, interrompa e procure orientação profissional.";

    // Personalização simples pelo texto
    const notesLower = (state.notes || "").toLowerCase();
    const goalLower  = (state.goal || "").toLowerCase();

    const emphasizeHands = notesLower.includes("mão") || notesLower.includes("polegar") || notesLower.includes("dedo") || goalLower.includes("coordenação");
    const emphasizeCerv  = notesLower.includes("cervical") || notesLower.includes("pescoço") || notesLower.includes("tensão") || goalLower.includes("dor");

    const extra = [];
    if (emphasizeHands) extra.push("Foco extra em mãos/dedos: faça os movimentos mais lentos e com pausas.");
    if (emphasizeCerv)  extra.push("Foco extra cervical: mantenha postura neutra e evite trancos.");

    state.planText =
`Plano do dia (gerado pelo assistente)

Paciente: ${state.name}
Objetivo: ${state.goal}
Nível: ${state.level}
Observações: ${state.notes}

${intensity}

Rotina sugerida (15–25 min):
1) Mobilidade da Mão — 3 séries de 10 repetições (pausa 30–40s)
2) Extensão dos Dedos — 2×8 (um dedo por vez) + 2×10 (todos juntos)
3) Alongamento Cervical Leve — 2 séries por direção (15–20s)

${extra.length ? "Observações do assistente:\n- " + extra.join("\n- ") + "\n" : ""}
Segurança: ${safety}
`;
    saveState();
    refreshDemoStatus();
    toast("Plano gerado.");
  }

  // --------------------------- STORAGE ---------------------------
  function loadState(){
    try{
      const raw = localStorage.getItem(STATE_KEY);
      if(!raw) return structuredClone(DEFAULT_STATE);
      const parsed = JSON.parse(raw);
      return { ...structuredClone(DEFAULT_STATE), ...parsed, done: parsed.done || {} };
    }catch{
      return structuredClone(DEFAULT_STATE);
    }
  }
  function saveState(){
    localStorage.setItem(STATE_KEY, JSON.stringify(state));
  }

  // --------------------------- UTIL ---------------------------
  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function escapeAttr(s){
    return escapeHtml(s).replaceAll("\n"," ");
  }

  function refreshDemoStatus(){
    const hasPlan = !!state.planText;
    demoStatusEl.textContent = hasPlan ? "Pronto p/ Demo" : "Gerar Plano";
    demoStatusEl.style.borderColor = hasPlan ? "rgba(34,197,94,.35)" : "rgba(245,158,11,.35)";
    demoStatusEl.style.background  = hasPlan ? "rgba(34,197,94,.18)" : "rgba(245,158,11,.10)";
    demoStatusEl.style.color       = hasPlan ? "#d7ffe7" : "#ffe9bf";
  }

  // Toast simples
  let toastTimer = null;
  function toast(msg){
    clearTimeout(toastTimer);
    let t = document.getElementById("toast");
    if(!t){
      t = document.createElement("div");
      t.id = "toast";
      t.style.position = "fixed";
      t.style.bottom = "18px";
      t.style.left = "50%";
      t.style.transform = "translateX(-50%)";
      t.style.padding = "10px 12px";
      t.style.borderRadius = "14px";
      t.style.border = "1px solid rgba(255,255,255,.10)";
      t.style.background = "rgba(0,0,0,.55)";
      t.style.color = "white";
      t.style.fontSize = "12px";
      t.style.backdropFilter = "blur(8px)";
      t.style.boxShadow = "0 16px 50px rgba(0,0,0,.35)";
      document.body.appendChild(t);
    }
    t.textContent = msg;
    t.style.opacity = "1";
    toastTimer = setTimeout(()=>{ t.style.opacity="0"; }, 1600);
  }

  // --------------------------- INIT ---------------------------
  renderNav();
  go("home");
</script>
</body>
</html>
